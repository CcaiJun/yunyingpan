# Yingpan (影盘) - 虚拟 WebDAV 硬盘

Yingpan 是一个基于 Python 开发的虚拟硬盘管理工具，它通过 FUSE 技术将 WebDAV 云存储映射为本地的 `.img` 镜像文件，并挂载为本地磁盘。这让你可以像使用普通硬盘一样使用云盘（如 123云盘、阿里云盘等支持 WebDAV 的服务），支持直接运行程序、读写文件。

## 核心特性

- **WebDAV 转本地盘**: 支持将任何标准 WebDAV 服务挂载为本地 ext4 文件系统。
- **高性能分块缓存**: 采用分块加载技术，仅下载正在读取的数据块，大幅提升响应速度。
- **智能后台上传**: 写入操作先存入本地缓存，由后台线程异步上传至云端，保证操作流畅。
- **图形化管理界面**: 内置基于 FastAPI 的 Web 控制台，支持磁盘创建、挂载、卸载及状态监控。
- **持久化配置**: 磁盘配置自动保存，支持服务重启后自动重连。
- **Systemd 集成**: 提供一键部署脚本，支持开机自启和故障自恢复。

## 快速部署

### 环境要求
- Linux 系统 (推荐 Ubuntu/Debian/CentOS)
- Python 3.8+
- Root 权限 (用于挂载 FUSE 和 Loop 设备)

### 一键安装
1. 将本项目文件夹复制到服务器。
2. 进入目录并执行部署脚本：
   ```bash
   cd yingpan
   sudo ./deploy.sh
   ```

## 使用说明

### 1. 访问控制台
部署完成后，打开浏览器访问：
`http://你的服务器IP:8001`

### 2. 创建磁盘
在“新增磁盘”页面填写以下信息：
- **WebDAV URL**: 云盘的 WebDAV 地址。
- **账号/密码**: 您的云盘登录凭据。
- **磁盘容量**: 虚拟出的硬盘大小（例如 1024G）。
- **挂载路径**: FUSE 层挂载路径（如 `/mnt/fdisk2`）。
- **缓存目录**: 本地缓存存放位置（如 `/var/cache/v_drive`）。

### 3. 本地使用
磁盘挂载成功后，会自动挂载到 `/mnt/v_disks/磁盘名`。您可以直接通过命令行或文件管理器访问该目录。

## 管理服务

使用标准 `systemd` 命令管理应用：
- **启动**: `sudo systemctl start yingpan`
- **停止**: `sudo systemctl stop yingpan`
- **重启**: `sudo systemctl restart yingpan`
- **查看日志**: `tail -f server.log`

## 项目结构
- `server.py`: FastAPI 后端服务，负责 API 和逻辑控制。
- `v_drive.py`: 核心 FUSE 实现，负责 WebDAV 与块设备的映射。
- `index.html`: 管理控制台前端页面。
- `deploy.sh`: 自动化部署与服务配置脚本。
- `disks_config.json`: 硬盘配置文件（自动生成）。

## 注意事项
- 请确保服务器已安装 `fuse3`。
- 对于大容量硬盘，首次格式化（mkfs）可能需要几分钟时间，请耐心等待状态变为 `running`。
- 缓存目录建议设置在 SSD 上以获得最佳性能。
